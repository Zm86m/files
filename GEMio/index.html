<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message Client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #error-message {
            color: red;
            font-size: 2em; /* Large text */
            position: fixed; /* Fixed positioning */
            top: 50%; /* Center vertically */
            left: 50%; /* Center horizontally */
            transform: translate(-50%, -50%); /* Adjust for centering */
            z-index: 10; /* Ensure it's above other elements */
            backdrop-filter: blur(5px); /* Blur effect */
            display: none; /* Hidden by default */
        }
        #content {
            filter: blur(0); /* No blur effect initially */
        }
    </style>
    <script>
        const SERVER_URL = 'https://verbose-garbanzo-pj79v5j74jqpc975r-3000.app.github.dev';

        async function sendMessage() {
            const name = document.getElementById('name').value;
            const message = document.getElementById('message').value;

            const response = await fetch(`${SERVER_URL}/p1`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ name, message }),
            });

            const result = await response.json();
            console.log(result);
            document.getElementById('name').value = '';
            document.getElementById('message').value = '';
            fetchMessages(); // Optionally fetch messages after sending
        }

        async function fetchMessages() {
            try {
                const response = await fetch(`${SERVER_URL}/g1`);
                const messagesList = document.getElementById('messages');
                const errorMessage = document.getElementById('error-message');
                const content = document.getElementById('content');

                // Clear previous error message
                errorMessage.style.display = 'none';
                content.style.filter = 'blur(0)'; // Clear blur

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const messages = await response.json();
                messagesList.innerHTML = ''; // Clear the existing list

                messages.forEach(msg => {
                    const li = document.createElement('li');
                    li.textContent = `${msg.name}: ${msg.mess}`;
                    messagesList.appendChild(li);
                });
            } catch (error) {
                console.error('Fetch error:', error);
                const errorMessage = document.getElementById('error-message');
                const content = document.getElementById('content');

                errorMessage.style.display = 'block'; // Show error message
                content.style.filter = 'blur(5px)'; // Apply blur effect to content
            }
        }

        // Fetch messages every 2 seconds
        setInterval(fetchMessages, 2000);
    </script>
</head>
<body>
    <div id="content">
        <h1>Message Client</h1>
        <input type="text" id="name" placeholder="Your Name" required>
        <input type="text" id="message" placeholder="Your Message" required>
        <button onclick="sendMessage()">Send Message</button>

        <h2>Messages</h2>
        <ul id="messages"></ul>
    </div>
    <div id="error-message">No Server Available</div> <!-- Error message div -->

    <script>
        // Initial fetch on page load
        fetchMessages();
    </script>
</body>
</html>